<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Utter Locks — NFL</title>
  <meta name="description" content="NFL picks (Utter Locks)" />

  <link rel="preconnect" href="https://a.espncdn.com" crossorigin>
  <link rel="icon" type="image/jpeg" href="assets/utter-locks-logo.jpg" />
  <meta property="og:title" content="Utter Locks — NFL Projections">
  <meta property="og:description" content="Data-driven NFL projections & picks.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">

  <style>
    :root{
      --bg:#0b1020; --bg2:#0f1730; --card:#111a36; --text:#eaf0ff; --muted:#a8b3d0; --brand:#7bdcff; --good:#78ffa6;
      --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
      --pickGlow: 0 0 0 1px rgba(255,77,77,.55),
                  0 0 10px rgba(255,77,77,.45),
                  0 0 20px rgba(255,77,77,.35);
      --pickGlowPulse: 0 0 0 2px rgba(255,77,77,.7),
                       0 0 16px rgba(255,77,77,.55),
                       0 0 32px rgba(255,77,77,.45);
      --tight:#F3C97A;
    }

    *{ box-sizing: border-box }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial; color:var(--text);
      background: radial-gradient(1200px 800px at 10% -20%, var(--bg2), transparent),
                  radial-gradient(1200px 800px at 100% 120%, var(--bg2), transparent),
                  var(--bg);
      padding: 28px;
    }
    .shell{ max-width:1100px; margin:0 auto; }
    header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px; }
    .brand{ display:flex; align-items:center; gap:12px; padding:10px 14px; border-radius: calc(var(--radius) + 6px); background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.10); box-shadow:var(--shadow); }
    .logo-img{ display:block; width:28px; height:28px; object-fit:cover; border-radius:8px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); }
    .title{ margin:0; font-size:24px; display:inline-flex; gap:10px; align-items:center; }
    .title::after{ content:""; width:10px; height:10px; border-radius:50%; background: radial-gradient(circle at 30% 30%, var(--brand) 30%, var(--good) 100%); box-shadow: 0 0 12px rgba(123,220,255,.6); }
    .subtitle{ margin:2px 0 0; color:var(--muted); font-size:13px }

    .panel{ background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.10); border-radius: var(--radius); box-shadow:var(--shadow); padding:16px; backdrop-filter: blur(8px); }

    .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap: wrap; }
    a.btn, button.btn, label.btn{ appearance:none; cursor:pointer; border:none; text-decoration:none; color:var(--text); background:var(--card); padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.10); font-weight:700; letter-spacing:.3px; }
    a.btn:hover, button.btn:hover, label.btn:hover{ filter:brightness(1.05) }

    #adminBar{ display:none; gap:8px; align-items:center; } #adminBar.show{ display:flex; } #file{ display:none }

    .table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling: touch; }
    table{ width:100%; border-collapse: collapse; margin-top:12px; table-layout: auto; min-width: 560px; }
    thead th{ position:sticky; top:0; background:rgba(15,23,48,.9); color:#fff; font-size:13px; letter-spacing:.3px; z-index:1; border-bottom: 1px solid rgba(255,255,255,.18); }
    th, td{ border-bottom:1px solid rgba(255,255,255,.08); padding:10px; text-align:center; vertical-align: middle; }

    tbody tr:nth-child(odd){ background: rgba(255,255,255,.02); }
    tbody tr:hover{ background: rgba(123,220,255,.08); box-shadow: inset 0 0 0 9999px rgba(123,220,255,.06); }

    td:nth-child(3), td:nth-child(4), td:nth-child(5), th:nth-child(3), th:nth-child(4), th:nth-child(5){ font-variant-numeric: tabular-nums; }

    .teams{ display:inline-grid; grid-template-columns: 1fr; gap:6px; text-align:left; }
    .team{ display:flex; align-items:center; gap:8px; min-width: 0; }
    .team img{ height:22px; width:22px; object-fit: contain; border-radius: 6px; background:#fff; flex: 0 0 22px; transition: box-shadow .35s ease; }
    .team span{ display:block; white-space:nowrap; line-height:1.2; }

    .team.pick img{ box-shadow: var(--pickGlow); }
    @keyframes glowPulseRed{
      0%,100% { box-shadow: var(--pickGlow); }
      50%     { box-shadow: var(--pickGlowPulse); }
    }
    .team.pick img{ animation: glowPulseRed 2.8s ease-in-out infinite; }
    @media (prefers-reduced-motion: reduce){ .team.pick img{ animation: none; } }

    .scores{ display: grid; grid-auto-rows: min-content; gap: 6px; justify-items: center; align-content: center; text-align: center; }
    .score{ line-height:1.2; font-variant-numeric: tabular-nums; font-feature-settings:"tnum"; }

    .muted{ color:var(--muted) }

    col.col-idx{ width:56px; }
    col.col-teams{ width:1%; }
    col.col-proj{ width:120px; }
    col.col-spr{  width:120px; }
    col.col-tot{  width:96px; }

    .chev{ font-size:13px; opacity:.9; margin-left:6px; }
    .tight-dot{ display:inline-block; width:7px; height:7px; border-radius:50%; background:var(--tight); box-shadow: 0 0 0 1px rgba(255,255,255,.15), 0 0 8px rgba(243,201,122,.45); margin-left:6px; vertical-align:middle; }
    .pill{ display:inline-block; font-size:11px; line-height:1; padding:4px 6px; border-radius:8px; border:1px solid rgba(255,77,77,.5); color:#ffd9d9; background:rgba(255,77,77,.12); margin-left:8px; white-space:nowrap; }

    .legend{ display:flex; flex-wrap:wrap; gap:10px 16px; align-items:center; color:var(--muted); font-size:12px; padding:6px 2px 0; }
    .legend span{ display:inline-flex; align-items:center; gap:6px; }
    .legend .glow-demo{ display:inline-block; width:14px; height:14px; border-radius:4px; background:#fff; box-shadow: var(--pickGlow); }

    @media (max-width: 780px){
      body{ padding:20px; } .title{ font-size:22px; } .subtitle{ font-size:12px; }
      th, td{ padding:8px 6px; font-size:13px; }
      .team img{ height:20px; width:20px; flex-basis:20px; } .team span{ font-size:13px; }
      table{ min-width: 520px; }
    }
    @media (max-width: 560px){
      .scores{ gap:2px; justify-items:end; text-align:right; }
      .scores .score{ font-size:12px; line-height:1.1; }
      .table-wrap table{ table-layout: fixed; }
      col.col-teams{ width:52%; }
      col.col-proj{  width:100px; }
      col.col-spr{   width:92px; }
      col.col-tot{   width:84px; }
      th:nth-child(2), td:nth-child(2){ width:auto; }
      .team span{ white-space:normal; }
      .legend{ font-size:11px; }
    }
    @media (max-width: 520px){
      th:first-child, td:first-child{ display:none; }
      .title{ font-size:20px; }
      .team img{ height:18px; width:18px; flex-basis:18px; }
      table{ min-width: 460px; }
      .teams{ display:grid; }
    }
    @media (max-width: 420px){
      col.col-teams{ width:58%; }
      col.col-proj{  width:96px; }
      col.col-spr{   width:88px; }
      col.col-tot{   width:78px; }
    }

    footer{ text-align:center; margin-top:14px; color:var(--muted); font-size:12px }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">
        <img class="logo-img" src="assets/utter-locks-logo.jpg" alt="Utter Locks logo" width="28" height="28">
        <div>
          <h1 class="title">Utter Locks — NFL</h1>
          <p class="subtitle">National Football League Picks</p>
        </div>
      </div>
      <div class="row">
        <a class="btn" href="index.html">← Home</a>
        <div id="adminBar">
          <input id="file" type="file" accept=".csv" />
          <label class="btn" for="file">Preview CSV (admin)</label>
          <button class="btn" id="useRepo">Use repo data</button>
        </div>
      </div>
    </header>

    <section class="panel">
      <div class="legend" aria-label="Legend">
        <span><span class="glow-demo" aria-hidden="true"></span> Spread Pick (logo glow)</span>
        <span><span class="tight-dot" aria-hidden="true"></span> Best Edge ≤ 1.5</span>
        <span><span class="chev" aria-hidden="true">▲</span> Total: Over</span>
        <span><span class="chev" aria-hidden="true">▼</span> Total: Under</span>
        <span><span class="pill" aria-hidden="true">FADE</span> |Spread Edge| ≥ 5</span>
      </div>

      <div class="table-wrap">
        <table id="tbl">
          <colgroup>
            <col class="col-idx"><col class="col-teams"><col class="col-proj"><col class="col-spr"><col class="col-tot">
          </colgroup>
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Teams</th>
              <th scope="col">Proj (A-H)</th>
              <th scope="col">xSpread (A-H)</th>
              <th scope="col">xTotal</th>
            </tr>
          </thead>
          <tbody id="body"></tbody>
        </table>
      </div>
    </section>

    <footer>© <span id="year"></span> Utter Locks • Advice/analysis only</footer>
  </div>

  <script>
    const $body = document.getElementById('body');
    const isAdmin = new URLSearchParams(location.search).get('admin') === '1' || location.hostname === 'localhost';
    if (isAdmin) document.getElementById('adminBar').classList.add('show');
    document.getElementById('year').textContent = new Date().getFullYear();

    const CSV_OVERRIDE = new URLSearchParams(location.search).get('csv');
    const REPO_CSV = CSV_OVERRIDE ? new URL(CSV_OVERRIDE, location.href).toString() : new URL('./data/nfl.csv', location.href).toString();

    loadFromRepo();
    document.getElementById('useRepo').addEventListener('click', loadFromRepo);
    document.getElementById('file').addEventListener('change', (e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = ev => { const rows = parseCSV(ev.target.result); render(rows); };
      reader.readAsText(file);
    });

    async function loadFromRepo(){
      try{
        const bust = Date.now();
        const url = REPO_CSV + (REPO_CSV.includes('?') ? `&v=${bust}` : `?v=${bust}`);
        const res = await fetch(url);
        if(!res.ok){ throw new Error(`HTTP ${res.status} at ${url}`); }
        const rows = parseCSV(await res.text());
        render(rows);
      }catch(err){
        console.error(err);
        $body.innerHTML = `<tr><td colspan="5" class="muted">Could not fetch CSV. ${err.message}.<br>Make sure the file exists at <code>${REPO_CSV}</code>.</td></tr>`;
      }
    }

    function parseCSV(text){
      const lines = text.replace(/\r/g,'').split('\n').filter(Boolean);
      const header = splitCSVLine(lines[0]); const out = [];
      for(let i=1;i<lines.length;i++){ const cells = splitCSVLine(lines[i]); const row = {}; header.forEach((h,idx)=> row[h.trim()] = (cells[idx] ?? '').trim()); out.push(row); }
      return out;
    }
    function splitCSVLine(line){
      const cells = []; let cur = ''; let q = false;
      for(let i=0;i<line.length;i++){
        const ch = line[i];
        if(ch==='"'){ if(q && line[i+1]==='"'){ cur+='"'; i++; } else { q=!q; } }
        else if(ch===',' && !q){ cells.push(cur); cur=''; }
        else { cur += ch; }
      }
      cells.push(cur); return cells;
    }
    const n = x => { const v = Number(x); return Number.isFinite(v) ? v : null; };
    const norm = s => (s ?? '').toString().toLowerCase().replace(/[^a-z0-9]+/g,'').trim();

    const TIGHT = 1.5;
    const FADE = 5;

    function render(rows){
      if(!rows?.length){ $body.innerHTML = '<tr><td colspan="5" class="muted">No rows</td></tr>'; return; }

      $body.innerHTML = rows.map((r,idx)=>{
        const i = idx+1;
        const h = r.Home || '';
        const a = r.Away || '';
        const hlogo = r['Home Logo'] || r.HomeLogo;
        const alogo = r['Away Logo'] || r.AwayLogo;

        const hp = n(r.xHome);
        const ap = n(r.xAway);
        const xSpr = n(r.xSpread);
        const xTot = n(r.xTotal);

        const sprEdge = n(r['Spread Edge']);
        const totEdge = n(r['Total Edge']);

        const sprBet = r['Spread Bet'] || '';
        const totBet = (r['Total Bet'] || '').toLowerCase();

        const spreadBetNorm = norm(sprBet);
        const isHomePick = spreadBetNorm && spreadBetNorm === norm(h);
        const isAwayPick = spreadBetNorm && spreadBetNorm === norm(a);

        const projHTML = `
          <div class="scores">
            <div class="score">${ap!=null ? ap.toFixed(1) : '—'}</div>
            <div class="score">${hp!=null ? hp.toFixed(1) : '—'}</div>
          </div>`;

        const tightDot = `<span class="tight-dot" aria-label="Tight edge" title="Tight edge (≤ ${TIGHT})"></span>`;
        const spreadIsTight = sprEdge!=null && Math.abs(sprEdge) <= TIGHT;
        const totalIsTight  = totEdge!=null && Math.abs(totEdge) <= TIGHT;
        const fadeSpread = sprEdge!=null && Math.abs(sprEdge) >= FADE ? `<span class="pill" title="Edge ≥ ${FADE}: consider fading model spread">FADE</span>` : '';

        const sprTxt = xSpr!=null ? `${xSpr>0?`+${xSpr.toFixed(1)}`:xSpr.toFixed(1)}${spreadIsTight ? tightDot : ''}${fadeSpread}` : '—';

        let chev = '';
        if(totBet === 'over')  chev = ` <span class="chev" title="Total: Over">▲</span>`;
        if(totBet === 'under') chev = ` <span class="chev" title="Total: Under">▼</span>`;
        const totTxt = xTot!=null ? `${xTot.toFixed(1)}${totalIsTight ? tightDot : ''}${chev}` : '—';

        return `
          <tr>
            <td>${i}</td>
            <td>
              <div class="teams">
                <div class="team ${isAwayPick ? 'pick' : ''}">
                  <img loading="lazy" decoding="async" src="${alogo}" alt="${a}"><span>${a}</span>
                </div>
                <div class="team ${isHomePick ? 'pick' : ''}">
                  <img loading="lazy" decoding="async" src="${hlogo}" alt="${h}"><span>${h}</span>
                </div>
              </div>
            </td>
            <td>${projHTML}</td>
            <td>${sprTxt}</td>
            <td>${totTxt}</td>
          </tr>`;
      }).join('');
    }
  </script>
</body>
</html>
